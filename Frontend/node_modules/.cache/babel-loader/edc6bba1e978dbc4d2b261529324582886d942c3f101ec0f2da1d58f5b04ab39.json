{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\divya\\\\Downloads\\\\Movie Booking Frontend\\\\Frontend\\\\src\\\\context\\\\AuthContext.jsx\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\nimport React, { createContext, useContext, useState, useEffect, useCallback } from 'react';\nimport { authAPI, userAPI } from '../services/api';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst AuthContext = /*#__PURE__*/createContext();\nconst decodeJwt = token => {\n  try {\n    const base64 = token.split('.')[1].replace(/-/g, '+').replace(/_/g, '/');\n    return JSON.parse(atob(base64));\n  } catch {\n    return null;\n  }\n};\nexport const AuthProvider = ({\n  children\n}) => {\n  _s();\n  var _user$roles;\n  const [user, setUser] = useState(null);\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState(null);\n  useEffect(() => {\n    const token = localStorage.getItem('jwt_token');\n    const saved = localStorage.getItem('user_data');\n    if (token && saved) {\n      const decoded = decodeJwt(token);\n      if (decoded && decoded.exp * 1000 > Date.now()) {\n        setUser(JSON.parse(saved));\n      } else {\n        localStorage.removeItem('jwt_token');\n        localStorage.removeItem('user_data');\n      }\n    }\n  }, []);\n  const fetchUserData = async email => {\n    try {\n      const res = await userAPI.getAll();\n      const found = res.data.find(u => u.email === email);\n      if (found) return found;\n    } catch {}\n    return {\n      email,\n      name: email.split('@')[0]\n    };\n  };\n  const login = async (email, password) => {\n    setLoading(true);\n    setError(null);\n    try {\n      var _res$data;\n      const res = await authAPI.login(email, password);\n      // Response data is a plain string JWT\n      const token = typeof res.data === 'string' ? res.data.trim() : (_res$data = res.data) === null || _res$data === void 0 ? void 0 : _res$data.token;\n      if (!token) throw new Error('No token received');\n      localStorage.setItem('jwt_token', token);\n\n      // Get email from JWT, then fetch full user data\n      const decoded = decodeJwt(token);\n      const userEmail = (decoded === null || decoded === void 0 ? void 0 : decoded.sub) || email;\n      const userData = await fetchUserData(userEmail);\n      localStorage.setItem('user_data', JSON.stringify(userData));\n      setUser(userData);\n      return {\n        ok: true\n      };\n    } catch (e) {\n      var _e$response, _e$response$data, _e$response2, _e$response3;\n      // Backend returns 500 for bad credentials (GlobalExceptionHandler bug)\n      // or 401 from Spring Security\n      const msg = ((_e$response = e.response) === null || _e$response === void 0 ? void 0 : (_e$response$data = _e$response.data) === null || _e$response$data === void 0 ? void 0 : _e$response$data.message) || ((_e$response2 = e.response) === null || _e$response2 === void 0 ? void 0 : _e$response2.data) || (((_e$response3 = e.response) === null || _e$response3 === void 0 ? void 0 : _e$response3.status) === 401 ? 'Invalid email or password.' : 'Login failed. Please try again.');\n      setError(typeof msg === 'string' ? msg : 'Login failed.');\n      return {\n        ok: false\n      };\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  /**\n   * REGISTER\n   * Backend: POST /api/auth/register { name, email, password, phoneNumber }\n   * phoneNumber is NOT NULL in DB — required\n   * Returns: plain String \"User registered successfully\"\n   * We auto-login after success.\n   */\n  const register = async (name, email, password, phoneNumber) => {\n    setLoading(true);\n    setError(null);\n    try {\n      await authAPI.register(name, email, password, phoneNumber || '0000000000');\n      // Auto login after register\n      return await login(email, password);\n    } catch (e) {\n      var _e$response4;\n      const raw = (_e$response4 = e.response) === null || _e$response4 === void 0 ? void 0 : _e$response4.data;\n      const msg = (typeof raw === 'string' ? raw : raw === null || raw === void 0 ? void 0 : raw.message) || 'Registration failed.';\n      // Common case: \"Email already exists\" thrown as RuntimeException → 500\n      setError(msg.includes('Email already exists') ? 'This email is already registered.' : msg);\n      return {\n        ok: false\n      };\n    } finally {\n      setLoading(false);\n    }\n  };\n  const logout = useCallback(() => {\n    localStorage.removeItem('jwt_token');\n    localStorage.removeItem('user_data');\n    setUser(null);\n  }, []);\n  const isAdmin = (user === null || user === void 0 ? void 0 : (_user$roles = user.roles) === null || _user$roles === void 0 ? void 0 : _user$roles.some(r => (typeof r === 'string' ? r : r === null || r === void 0 ? void 0 : r.name) === 'ADMIN')) || false;\n  return /*#__PURE__*/_jsxDEV(AuthContext.Provider, {\n    value: {\n      user,\n      loading,\n      error,\n      setError,\n      login,\n      register,\n      logout,\n      isAdmin\n    },\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 122,\n    columnNumber: 5\n  }, this);\n};\n_s(AuthProvider, \"KZ+R4Ix943hwtV2zUD3Y8R+zx0E=\");\n_c = AuthProvider;\nexport const useAuth = () => {\n  _s2();\n  return useContext(AuthContext);\n};\n_s2(useAuth, \"gDsCjeeItUuvgOWf1v4qoK9RF6k=\");\nvar _c;\n$RefreshReg$(_c, \"AuthProvider\");","map":{"version":3,"names":["React","createContext","useContext","useState","useEffect","useCallback","authAPI","userAPI","jsxDEV","_jsxDEV","AuthContext","decodeJwt","token","base64","split","replace","JSON","parse","atob","AuthProvider","children","_s","_user$roles","user","setUser","loading","setLoading","error","setError","localStorage","getItem","saved","decoded","exp","Date","now","removeItem","fetchUserData","email","res","getAll","found","data","find","u","name","login","password","_res$data","trim","Error","setItem","userEmail","sub","userData","stringify","ok","e","_e$response","_e$response$data","_e$response2","_e$response3","msg","response","message","status","register","phoneNumber","_e$response4","raw","includes","logout","isAdmin","roles","some","r","Provider","value","fileName","_jsxFileName","lineNumber","columnNumber","_c","useAuth","_s2","$RefreshReg$"],"sources":["C:/Users/divya/Downloads/Movie Booking Frontend/Frontend/src/context/AuthContext.jsx"],"sourcesContent":["import React, { createContext, useContext, useState, useEffect, useCallback } from 'react';\nimport { authAPI, userAPI } from '../services/api';\n\nconst AuthContext = createContext();\n\n\nconst decodeJwt = (token) => {\n  try {\n    const base64 = token.split('.')[1].replace(/-/g, '+').replace(/_/g, '/');\n    return JSON.parse(atob(base64));\n  } catch {\n    return null;\n  }\n};\n\nexport const AuthProvider = ({ children }) => {\n  const [user, setUser]       = useState(null);\n  const [loading, setLoading] = useState(false);\n  const [error, setError]     = useState(null);\n\n  \n  useEffect(() => {\n    const token = localStorage.getItem('jwt_token');\n    const saved = localStorage.getItem('user_data');\n    if (token && saved) {\n      const decoded = decodeJwt(token);\n     \n      if (decoded && decoded.exp * 1000 > Date.now()) {\n        setUser(JSON.parse(saved));\n      } else {\n        localStorage.removeItem('jwt_token');\n        localStorage.removeItem('user_data');\n      }\n    }\n  }, []);\n\n \n  const fetchUserData = async (email) => {\n    try {\n      const res = await userAPI.getAll();\n      const found = res.data.find(u => u.email === email);\n      if (found) return found; \n    } catch {\n     \n    }\n   \n    return { email, name: email.split('@')[0] };\n  };\n\n  \n  const login = async (email, password) => {\n    setLoading(true);\n    setError(null);\n    try {\n      const res = await authAPI.login(email, password);\n      // Response data is a plain string JWT\n      const token = typeof res.data === 'string' ? res.data.trim() : res.data?.token;\n      if (!token) throw new Error('No token received');\n\n      localStorage.setItem('jwt_token', token);\n\n      // Get email from JWT, then fetch full user data\n      const decoded = decodeJwt(token);\n      const userEmail = decoded?.sub || email;\n      const userData = await fetchUserData(userEmail);\n\n      localStorage.setItem('user_data', JSON.stringify(userData));\n      setUser(userData);\n      return { ok: true };\n    } catch (e) {\n      // Backend returns 500 for bad credentials (GlobalExceptionHandler bug)\n      // or 401 from Spring Security\n      const msg =\n        e.response?.data?.message ||\n        e.response?.data ||\n        (e.response?.status === 401 ? 'Invalid email or password.' : 'Login failed. Please try again.');\n      setError(typeof msg === 'string' ? msg : 'Login failed.');\n      return { ok: false };\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  /**\n   * REGISTER\n   * Backend: POST /api/auth/register { name, email, password, phoneNumber }\n   * phoneNumber is NOT NULL in DB — required\n   * Returns: plain String \"User registered successfully\"\n   * We auto-login after success.\n   */\n  const register = async (name, email, password, phoneNumber) => {\n    setLoading(true);\n    setError(null);\n    try {\n      await authAPI.register(name, email, password, phoneNumber || '0000000000');\n      // Auto login after register\n      return await login(email, password);\n    } catch (e) {\n      const raw = e.response?.data;\n      const msg =\n        (typeof raw === 'string' ? raw : raw?.message) ||\n        'Registration failed.';\n      // Common case: \"Email already exists\" thrown as RuntimeException → 500\n      setError(msg.includes('Email already exists') ? 'This email is already registered.' : msg);\n      return { ok: false };\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const logout = useCallback(() => {\n    localStorage.removeItem('jwt_token');\n    localStorage.removeItem('user_data');\n    setUser(null);\n  }, []);\n\n  const isAdmin = user?.roles?.some(r =>\n    (typeof r === 'string' ? r : r?.name) === 'ADMIN'\n  ) || false;\n\n  return (\n    <AuthContext.Provider value={{ user, loading, error, setError, login, register, logout, isAdmin }}>\n      {children}\n    </AuthContext.Provider>\n  );\n};\n\nexport const useAuth = () => useContext(AuthContext);\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}